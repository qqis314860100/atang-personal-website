# Supabase 客户端与服务器端的区别

Supabase 在 Next.js 项目中分为客户端(client)和服务器端(server)两种用法，它们各自处理不同环境下的数据请求和认证：

## 客户端 (client.ts)

- 使用`createBrowserClient`
- 运行在**浏览器**环境中
- 处理用户交互操作发起的请求
- 适用于客户端组件中

## 服务器端 (server.ts)

- 使用`createServerClient`
- 运行在**服务器**环境中
- 处理服务器组件或 API 路由中的请求
- 能获取更多安全权限

## 中间件 (middleware.ts)

- 特殊的服务器端客户端
- 用于请求路由控制和会话管理
- 检查认证状态并处理权限

# Supabase 在 Next.js 项目中的执行流程

1. **中间件层处理**

   - 每个请求首先经过 middleware.ts
   - 验证用户会话状态
   - 根据认证状态和路由规则决定是否重定向
   - 例如：未登录用户访问受保护页面会被重定向到登录页

2. **服务器端渲染**

   - 在服务器组件中使用 server.ts 创建的客户端
   - 获取初始数据并预渲染页面
   - 可以安全地使用环境变量和敏感操作

3. **客户端交互**
   - 在客户端组件中使用 client.ts 创建的客户端
   - 处理用户操作触发的数据请求
   - 实现实时数据更新和用户交互

这种分离设计使 Supabase 能够适应 Next.js 的混合渲染模式，保证数据访问的安全性和性能。
