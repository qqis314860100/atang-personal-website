# 页面详细信息功能总结

## 🎯 **功能概述**

为页面热力图的每个项目添加了可点击展开的详细信息功能，提供更深入的页面分析数据。

## ✅ **新增功能**

### 1. 可点击展开的页面项目

**交互方式**:

- 点击任意页面项目可展开详细信息
- 再次点击可收起详细信息
- 同时只能展开一个页面项目

**视觉反馈**:

- 鼠标悬停时背景色变化
- 展开区域有缩进和特殊背景
- 平滑的过渡动画

### 2. 详细的页面统计信息

**基础统计**:

- 📊 **独立访客** - 访问该页面的唯一用户数
- 🎯 **跳出率** - 只访问一页就离开的用户比例
- ⏱️ **平均会话时长** - 用户在该页面的平均停留时间
- 👁️ **页面停留率** - 继续浏览其他页面的用户比例

**设备分析**:

- 📱 **设备分布** - 访问该页面的设备类型统计
- 🌐 **浏览器分布** - 访问该页面的浏览器类型统计

**来源分析**:

- 🔗 **主要来源** - 用户访问该页面的来源渠道
- ⏰ **访问时间分布** - 24 小时访问时间分布

## 📊 **数据展示**

### 展开前显示:

```
[1] 数据分析
    平均浏览 3分37秒
    9 浏览量
```

### 展开后显示:

```
[1] 数据分析
    平均浏览 3分37秒
    9 浏览量

    详细信息:
    ┌─────────────────────────────────────┐
    │ 👥 独立访客: 7                      │
    │ 🎯 跳出率: 35.2%                   │
    │ ⏱️ 平均会话时长: 5分23秒            │
    │ 👁️ 页面停留率: 64.8%               │
    │                                     │
    │ 📱 设备分布:                        │
    │   Desktop: 6次                     │
    │   Mobile: 3次                      │
    │                                     │
    │ 🌐 浏览器分布:                      │
    │   Chrome: 5次                      │
    │   Firefox: 2次                     │
    │   Safari: 2次                      │
    │                                     │
    │ 🔗 主要来源:                        │
    │   直接访问                          │
    │   Google搜索                        │
    │                                     │
    │ ⏰ 访问时间分布:                    │
    │   9时 3次  10时 5次  11时 2次      │
    │   14时 4次 15时 1次  16时 2次      │
    └─────────────────────────────────────┘
```

## 🛠️ **技术实现**

### 前端组件 (`PageHeatmap.tsx`)

```typescript
// 状态管理
const [expandedPage, setExpandedPage] = useState<string | null>(null)

// 点击处理
onClick={() => setExpandedPage(isExpanded ? null : page.page)}

// 条件渲染
{isExpanded && (
  <div className="ml-8 p-4 bg-gray-800/30 rounded-lg space-y-4">
    {/* 详细信息内容 */}
  </div>
)}
```

### 后端 API (`analytics.ts`)

```typescript
// 详细统计计算
const uniqueVisitors = new Set(
  pageViewsForPage.map((view) => view.user_id || view.session_id)
).size
const bounceRate = 0.35 + Math.random() * 0.3
const avgSessionDuration = page.avgTime * (1.5 + Math.random() * 1)

// 设备分布统计
const deviceStats: { [key: string]: number } = {}
pageViewsForPage.forEach((view) => {
  const device = view.device_type || 'desktop'
  deviceStats[device] = (deviceStats[device] || 0) + 1
})
```

## 🎨 **UI 设计**

### 视觉层次:

1. **主要信息** - 页面名称、浏览量、平均时间
2. **展开区域** - 缩进背景，清晰分隔
3. **统计网格** - 2x2 网格布局，图标+数据
4. **分布列表** - 设备、浏览器、来源分布
5. **时间图表** - 24 小时访问时间分布

### 颜色系统:

- 🔴 红色 - 高热度页面
- 🟠 橙色 - 中热度页面
- 🟡 黄色 - 低热度页面
- 🔵 蓝色 - 最低热度页面
- ⚪ 灰色 - 默认状态

### 图标系统:

- 👥 Users - 独立访客
- 🎯 MousePointer - 跳出率
- ⏱️ Clock - 平均会话时长
- 👁️ Eye - 页面停留率
- 📱 Smartphone/Monitor/Tablet - 设备类型
- 🌐 Globe - 浏览器
- 🔗 Link - 来源

## 📈 **数据来源**

### 真实数据:

- 页面浏览量
- 设备类型分布
- 浏览器类型分布
- 用户会话信息

### 模拟数据:

- 跳出率 (35-65%)
- 平均会话时长 (基于页面时间计算)
- 来源分布 (直接访问、搜索引擎等)
- 时间分布 (24 小时访问模式)

## 🧪 **测试验证**

### 功能测试:

```bash
# 运行测试脚本
node scripts/test-page-details.js
```

### 手动测试:

1. 访问 Dashboard 页面
2. 点击任意页面项目
3. 查看展开的详细信息
4. 验证数据准确性
5. 测试交互体验

## 🎉 **用户体验提升**

1. **信息层次清晰** - 主要信息一目了然，详细信息按需展开
2. **交互体验流畅** - 点击展开/收起，动画过渡
3. **数据展示丰富** - 多维度分析，深入洞察
4. **视觉设计美观** - 图标+颜色+布局，信息易读
5. **响应式适配** - 不同屏幕尺寸下都有良好体验

现在用户可以点击任意页面项目查看详细的访问分析数据！🎯
