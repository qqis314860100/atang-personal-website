# 智能中文映射工具使用指南

## 概述

智能中文映射工具是一个创新的国际化解决方案，允许开发者在开发时使用中文，但底层仍然保持英文 key + 模块化的架构。这个工具解决了传统国际化方案中中文 key 重复、难以维护等问题。

## 核心特性

### 1. **智能映射**

- 自动检测重复的中文 key
- 智能添加上下文避免冲突
- 支持嵌套键结构

### 2. **开发便利性**

- 开发时直接使用中文
- 无需记忆英文 key
- 支持 IDE 自动补全

### 3. **模块化架构**

- 按功能模块组织语言包
- 支持命名空间隔离
- 易于维护和扩展

## 使用方法

### 基本用法

```typescript
import { useI18n } from '@/app/hooks/use-i18n'

export function MyComponent() {
  const t = useI18n()

  return (
    <div>
      <h1>{t.dashboard('个人信息')}</h1>
      <p>{t.dashboard('请使用您可以接收邮件的永久地址。')}</p>
      <button>{t.common('保存')}</button>
    </div>
  )
}
```

### 高级用法

#### 1. 使用上下文避免冲突

```typescript
// 当不同模块有相同的中文key时，使用上下文区分
{
  t.dashboard('删除', { context: 'dashboard' })
} // 删除账户
{
  t.common('删除', { context: 'common' })
} // 通用删除操作
```

#### 2. 使用 fallback

```typescript
{
  t.common('不存在的key', { fallback: '这是备用文本' })
}
```

#### 3. 使用参数

```typescript
// 支持next-intl的参数功能
{
  t.common('欢迎 {name}', { params: { name: '张三' } })
}
```

#### 4. 嵌套键支持

```typescript
// 自动处理嵌套结构
{
  t.dashboard('名字')
} // 对应 inputs.firstName.label
{
  t.dashboard('请输入您的名字')
} // 对应 inputs.firstName.placeholder
```

## 语言包结构

### 中文语言包 (messages/zh/)

```json
{
  "personalInfo": {
    "title": "个人信息",
    "description": "请使用您可以接收邮件的永久地址。"
  },
  "inputs": {
    "firstName": {
      "label": "名字",
      "placeholder": "请输入您的名字"
    }
  }
}
```

### 英文语言包 (messages/en/)

```json
{
  "personalInfo": {
    "title": "Personal Information",
    "description": "Please use a permanent address where you can receive mail."
  },
  "inputs": {
    "firstName": {
      "label": "First Name",
      "placeholder": "Please enter your first name"
    }
  }
}
```

## 自动生成缓存

### 运行生成脚本

```bash
node scripts/generate-zh-cache.cjs
```

### 生成的缓存结构

```typescript
export const zhToEnCache = {
  个人信息: {
    namespace: 'dashboard',
    key: 'personalInfo.title',
  },
  名字: {
    namespace: 'dashboard',
    key: 'inputs.firstName.label',
  },
  // 自动处理重复key
  'dashboard.删除': {
    namespace: 'dashboard',
    key: 'deleteAccount.button',
  },
  'common.删除': {
    namespace: 'common',
    key: 'delete',
  },
}
```

## 最佳实践

### 1. **命名约定**

- 使用描述性的中文文本
- 避免过于简短或模糊的描述
- 保持一致的术语使用

### 2. **模块化组织**

- 按功能模块组织语言包
- 避免跨模块的 key 重复
- 使用有意义的命名空间

### 3. **错误处理**

- 总是提供有意义的 fallback
- 监控控制台警告信息
- 定期检查未映射的 key

### 4. **性能优化**

- 缓存生成的映射
- 避免在渲染函数中重复调用
- 使用 React.memo 优化组件

## 故障排除

### 常见问题

#### 1. **找不到映射**

```
[i18n] 未找到中文key "xxx" 的映射
```

**解决方案**: 检查语言包文件，确保中文文本存在

#### 2. **翻译键未找到**

```
[i18n] 翻译键 "xxx" 在命名空间 "xxx" 中未找到
```

**解决方案**: 检查英文语言包，确保 key 存在

#### 3. **重复 key 冲突**

```
⚠️ 发现重复key "xxx"，添加上下文: namespace.xxx
```

**解决方案**: 这是正常现象，系统会自动处理

### 调试技巧

1. **检查控制台**: 查看警告和错误信息
2. **验证语言包**: 确保中英文语言包结构一致
3. **重新生成缓存**: 运行生成脚本更新映射
4. **检查命名空间**: 确保使用了正确的命名空间

## 扩展功能

### 1. **添加新的命名空间**

1. 在 `i18n/config.ts` 中添加新命名空间
2. 创建对应的语言包文件
3. 更新类型定义
4. 重新生成缓存

### 2. **自定义映射逻辑**

可以在 `use-i18n.ts` 中添加自定义的映射逻辑，例如：

- 模糊匹配
- 智能建议
- 自动纠错

### 3. **性能监控**

添加性能监控功能：

- 映射查找时间
- 缓存命中率
- 未映射 key 统计

## 总结

智能中文映射工具为 Next.js 项目提供了一个强大而灵活的国际化解决方案。它既保持了开发的便利性，又确保了架构的健壮性和可维护性。通过合理使用这个工具，可以大大提高国际化开发的效率和质量。
