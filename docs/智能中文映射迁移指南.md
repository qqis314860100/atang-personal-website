# 智能中文映射迁移指南

## 概述

本指南将帮助你逐步将现有的国际化调用替换为智能中文映射系统，提升开发体验和代码可维护性。

## 迁移步骤

### 1. 识别现有的国际化调用

#### 搜索模式

```bash
# 搜索 useTranslations 调用
grep -r "useTranslations" src/

# 搜索 t( 调用
grep -r "t(" src/

# 搜索特定的翻译键
grep -r "title\|label\|button" src/
```

#### 常见的国际化模式

```typescript
// 模式1: 直接使用 useTranslations
const t = useTranslations('common')
return <button>{t('save')}</button>

// 模式2: 多个命名空间
const t1 = useTranslations('form')
const t2 = useTranslations('common')
return (
  <div>
    {t1('title')} {t2('save')}
  </div>
)

// 模式3: 动态命名空间
const t = useTranslations(namespace)
return <span>{t(key)}</span>
```

### 2. 迁移策略

#### 策略 1: 直接替换（推荐）

```typescript
// 迁移前
import { useTranslations } from 'next-intl'
const t = useTranslations('common')
return <button>{t('save')}</button>

// 迁移后
import { useI18n } from '@/app/hooks/use-i18n'
const t = useI18n()
return <button>{t.common('保存')}</button>
```

#### 策略 2: 批量替换

```typescript
// 迁移前
const t = useTranslations('dashboard')
return (
  <div>
    <h1>{t('personalInfo.title')}</h1>
    <p>{t('personalInfo.description')}</p>
    <button>{t('saveButton')}</button>
  </div>
)

// 迁移后
const t = useI18n()
return (
  <div>
    <h1>{t.dashboard('个人信息')}</h1>
    <p>{t.dashboard('请使用您可以接收邮件的永久地址。')}</p>
    <button>{t.dashboard('保存账户信息')}</button>
  </div>
)
```

### 3. 迁移优先级

#### 高优先级（立即迁移）

- 用户界面核心组件
- 导航和菜单组件
- 表单组件
- 错误提示和通知

#### 中优先级（计划迁移）

- 内容展示组件
- 设置页面
- 帮助文档

#### 低优先级（可选迁移）

- 管理后台
- 开发者工具
- 调试信息

### 4. 迁移检查清单

- [ ] 导入语句已更新
- [ ] 函数调用已替换
- [ ] 中文文本已添加
- [ ] 命名空间已指定
- [ ] 测试已通过
- [ ] 构建已成功

## 实际迁移示例

### 示例 1: 登录组件

#### 迁移前

```typescript
// app/[locale]/Login/components/Logon.tsx
import { useLocale } from 'next-intl'

export const Logon = () => {
  const locale = useLocale()

  return (
    <div>
      <h1>登录</h1>
      <button>登录</button>
      <p>忘记密码？</p>
    </div>
  )
}
```

#### 迁移后

```typescript
// app/[locale]/Login/components/Logon.tsx
import { useI18n } from '@/app/hooks/use-i18n'

export const Logon = () => {
  const t = useI18n()

  return (
    <div>
      <h1>{t.common('登录')}</h1>
      <button>{t.common('登录')}</button>
      <p>{t.common('忘记密码？')}</p>
    </div>
  )
}
```

### 示例 2: 仪表板组件

#### 迁移前

```typescript
// app/[locale]/dashboard/page.tsx
export default function AnalyticsPage() {
  return (
    <div>
      <h1>分析概览</h1>
      <p>查看您的网站性能数据</p>
      <button>刷新数据</button>
    </div>
  )
}
```

#### 迁移后

```typescript
// app/[locale]/dashboard/page.tsx
import { useI18n } from '@/app/hooks/use-i18n'

export default function AnalyticsPage() {
  const t = useI18n()

  return (
    <div>
      <h1>{t.dashboard('分析概览')}</h1>
      <p>{t.dashboard('查看您的网站性能数据')}</p>
      <button>{t.dashboard('刷新数据')}</button>
    </div>
  )
}
```

## 常见问题和解决方案

### 问题 1: 找不到中文 key 的映射

**症状**: 控制台显示警告 `[i18n] 未找到中文key "xxx" 的映射`

**解决方案**:

1. 检查语言包中是否包含该中文文本
2. 重新生成缓存: `npm run i18n-zh-cache`
3. 使用 fallback: `t.common('不存在的key', { fallback: '备用文本' })`

### 问题 2: 翻译键在命名空间中未找到

**症状**: 控制台显示警告 `[i18n] 翻译键 "xxx" 在命名空间 "xxx" 中未找到`

**解决方案**:

1. 检查英文语言包中是否有对应的键
2. 确认命名空间配置正确
3. 检查嵌套键的路径是否正确

### 问题 3: 重复 key 冲突

**症状**: 相同的中文文本显示不同的翻译

**解决方案**:

1. 使用上下文区分: `t.dashboard('删除', { context: 'dashboard' })`
2. 检查缓存生成日志中的冲突提示
3. 重新组织语言包结构

## 性能优化建议

### 1. 缓存优化

- 定期重新生成缓存
- 监控缓存命中率
- 考虑添加内存缓存

### 2. 查找优化

- 优先使用当前命名空间
- 合理使用上下文参数
- 避免频繁的 fallback

### 3. 构建优化

- 在生产构建中移除调试信息
- 使用代码分割减少包大小
- 监控翻译文件的加载性能

## 测试和验证

### 1. 单元测试

```typescript
import { renderHook } from '@testing-library/react'
import { useI18n } from '@/app/hooks/use-i18n'

test('should translate Chinese text correctly', () => {
  const { result } = renderHook(() => useI18n())
  expect(result.current.common('保存')).toBe('Save')
})
```

### 2. 集成测试

- 测试不同语言环境
- 测试命名空间切换
- 测试参数传递

### 3. 性能测试

- 测量翻译查找时间
- 监控内存使用
- 测试缓存效果

## 下一步

1. **开始迁移**: 选择一个简单的组件开始
2. **逐步扩展**: 按照优先级逐步迁移
3. **持续优化**: 监控性能并优化
4. **团队培训**: 分享最佳实践

## 支持

如果在迁移过程中遇到问题，请：

1. 查看控制台错误信息
2. 检查语言包配置
3. 重新生成缓存
4. 参考示例代码
5. 提交 issue 或寻求帮助

---

**记住**: 迁移是一个渐进的过程，不必一次性完成所有组件。建议先迁移核心功能，然后逐步扩展到其他部分。
