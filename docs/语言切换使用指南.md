# 语言切换使用指南

## 概述

本项目已集成智能中文映射系统和完整的多语言支持功能。用户可以轻松在中文和英文之间切换界面语言。

## 🌐 如何切换语言

### 方法一：使用 Header 导航栏（推荐）

1. **找到语言切换按钮**

   - 位置：页面顶部导航栏右侧
   - 图标：🌐 地球图标

2. **点击切换**

   - 点击地球图标打开语言选择下拉菜单
   - 选择你想要的语言：
     - 🇨🇳 中文
     - 🇺🇸 English

3. **自动切换**
   - 选择语言后，页面会自动切换到对应语言
   - URL 也会相应更新（例如：`/zh/dashboard` 或 `/en/dashboard`）

### 方法二：直接修改 URL

你也可以通过直接修改浏览器地址栏中的 URL 来切换语言：

- **中文页面**：`/zh/页面路径`
- **英文页面**：`/en/页面路径`

例如：

- 中文仪表板：`https://yoursite.com/zh/dashboard`
- 英文仪表板：`https://yoursite.com/en/dashboard`

## 🚀 技术实现

### 核心组件

1. **Header 组件**

   ```typescript
   const handleLanguageChange = (newLocale: string) => {
     // 使用 next-intl 的路由器进行语言切换
     router.replace(pathname, { locale: newLocale })
   }
   ```

2. **智能中文映射系统**
   ```typescript
   const t = useI18n()
   // 自动映射中文到对应语言
   t.navbar('中文') // 在中文环境显示"中文"，在英文环境显示"Chinese"
   ```

### 配置文件

1. **路由配置** (`i18n/routing.ts`)

   ```typescript
   export const routing = defineRouting({
     locales: ['zh', 'en'],
     defaultLocale: 'zh',
   })
   ```

2. **站点配置** (`data/siteMetadata.ts`)
   ```typescript
   const siteMetadata = {
     languages: ['zh', 'en'],
     fallbackLanguage: 'zh',
     // ...
   }
   ```

### 语言包结构

```
messages/
├── zh/          # 中文翻译
│   ├── common.json
│   ├── navbar.json
│   ├── dashboard.json
│   ├── auth.json
│   └── ...
└── en/          # 英文翻译
    ├── common.json
    ├── navbar.json
    ├── dashboard.json
    ├── auth.json
    └── ...
```

## 📱 支持的页面

目前已完成国际化的页面和组件：

### ✅ 已完成

- **Header 组件** - 导航栏和语言切换
- **登录组件** - 完整的身份验证界面
- **Dashboard 页面** - 仪表板主页
- **错误日志组件** - 完整的错误管理系统
- **404 错误页面** - 错误提示页面

### 🎯 已完成的 Dashboard 组件

- ErrorLogs - 错误日志管理
- ErrorLogsList - 错误日志列表
- ErrorLogItem - 错误日志项
- ErrorDetailModal - 错误详情模态框
- RealTimeToggle - 实时更新开关
- PageHeatmap - 页面热力图
- PerformanceHeatmap - 性能指标热力图

## 🛠️ 开发者指南

### 添加新的翻译

1. **添加中文翻译** (`messages/zh/namespace.json`)

   ```json
   {
     "newKey": "新的中文文本",
     "parameterizedKey": "包含 {param} 的文本"
   }
   ```

2. **添加英文翻译** (`messages/en/namespace.json`)

   ```json
   {
     "newKey": "New English text",
     "parameterizedKey": "Text with {param} parameter"
   }
   ```

3. **重新生成缓存**

   ```bash
   node scripts/generate-zh-cache.cjs
   ```

4. **在组件中使用**

   ```typescript
   const t = useI18n()

   // 简单翻译
   <span>{t.namespace('新的中文文本')}</span>

   // 参数化翻译
   <span>{t.namespace('包含 {param} 的文本', {
     params: { param: '动态值' }
   })}</span>
   ```

### 智能映射工作原理

1. **开发时使用中文**：开发者直接在组件中使用中文文本
2. **自动映射**：系统自动查找对应的英文翻译
3. **上下文感知**：处理重复中文 key 的冲突
4. **类型安全**：提供完整的 TypeScript 支持

## 🔍 故障排除

### 常见问题

1. **语言切换后页面没有更新**

   - 检查路由配置是否正确
   - 确认 `useRouter` 使用的是 `@/i18n/navigation` 而不是 `next/navigation`

2. **某些文本没有翻译**

   - 检查对应的语言包文件是否包含该键
   - 运行 `node scripts/generate-zh-cache.cjs` 重新生成缓存

3. **控制台出现翻译警告**
   - 检查翻译键是否正确
   - 确认语言包文件语法正确

### 调试技巧

1. **查看当前语言环境**

   ```typescript
   const currentLocale = useLocale()
   console.log('当前语言:', currentLocale)
   ```

2. **检查翻译映射**
   ```typescript
   import { zhToEnCache } from '@/utils/zh-cache'
   console.log('映射缓存:', zhToEnCache)
   ```

## 📊 当前状态

- **总翻译映射**: 270 个
- **支持语言**: 2 种（中文、英文）
- **已完成组件**: 10+个核心组件
- **上下文键**: 67 个（避免冲突）

## 🎯 下一步计划

1. **继续迁移组件**

   - 博客相关组件
   - 设置页面组件
   - 项目管理组件

2. **增强功能**

   - 添加更多语言支持
   - 性能优化
   - 用户偏好记忆

3. **完善体验**
   - 语言切换动画
   - 加载状态优化
   - 错误处理增强

## 💡 最佳实践

1. **保持一致性**：所有新组件都应使用智能中文映射系统
2. **命名规范**：使用清晰的命名空间组织翻译
3. **测试验证**：每次添加新翻译后都要测试两种语言
4. **文档更新**：及时更新翻译文档和使用指南

---

这个语言切换系统为项目提供了强大的国际化基础，支持快速扩展到更多语言，同时保持开发效率和用户体验。
