# Next.js 配置优化

```js
/** @type {import('next').NextConfig} */
const nextConfig = {
  // Vercel优化配置
  experimental: {
    serverComponentsExternalPackages: ['@supabase/supabase-js'],
  },

  // 图片优化
  images: {
    domains: ['your-domain.com', 'supabase.co'],
    formats: ['image/webp', 'image/avif'],
  },

  // 重定向配置
  async redirects() {
    return [
      {
        source: '/home',
        destination: '/',
        permanent: true,
      },
    ]
  },

  // 头部配置
  async headers() {
    return [
      {
        source: '/(.*)',
        headers: [
          {
            key: 'X-Frame-Options',
            value: 'DENY',
          },
          {
            key: 'X-Content-Type-Options',
            value: 'nosniff',
          },
        ],
      },
    ]
  },
}

export default nextConfig
```

# 部署验证脚本

```js
const https = require('https')
const { createClient } = require('@supabase/supabase-js')

const DOMAIN = process.env.NEXTAUTH_URL || 'https://your-domain.com'

async function verifyDeployment() {
  const checks = {
    domain: false,
    ssl: false,
    api: false,
    database: false,
  }

  try {
    // 检查域名访问
    const response = await fetch(DOMAIN)
    checks.domain = response.ok

    // 检查SSL证书
    checks.ssl = DOMAIN.startsWith('https://')

    // 检查API端点
    const apiResponse = await fetch(`${DOMAIN}/api/health`)
    checks.api = apiResponse.ok

    // 检查数据库连接
    if (process.env.SUPABASE_URL && process.env.SUPABASE_ANON_KEY) {
      const supabase = createClient(
        process.env.SUPABASE_URL,
        process.env.SUPABASE_ANON_KEY
      )
      const { error } = await supabase.from('profiles').select('count').limit(1)
      checks.database = !error
    }

    console.log('🔍 部署验证结果:')
    console.log(`域名访问: ${checks.domain ? '✅' : '❌'}`)
    console.log(`SSL证书: ${checks.ssl ? '✅' : '❌'}`)
    console.log(`API服务: ${checks.api ? '✅' : '❌'}`)
    console.log(`数据库: ${checks.database ? '✅' : '❌'}`)

    if (Object.values(checks).every((check) => check)) {
      console.log('\n🎉 部署验证成功！')
    } else {
      console.log('\n⚠️  部分功能需要检查')
    }
  } catch (error) {
    console.error('❌ 验证过程出错:', error.message)
  }
}

verifyDeployment()
```
